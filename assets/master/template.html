<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Viewer</title>

    <!-- Stylesheets - Adjust paths if template.html is elsewhere -->
    <!-- <link rel="stylesheet" href="../../style/mainapp.css"> -->
    <link rel="stylesheet" href="../../style/jquery.transposer.css">
    <link rel="stylesheet" href="../../style/song.css"> <!-- Your specific song view styles -->
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">

</head>

<body>

    <!-- Key Selection Buttons -->
    <div id="transpose-keys" class="transpose-keys">
        <!-- Buttons will be generated by nashville.js -->
    </div>

    <!-- Song Content Display Area -->
    <pre id="song-content" style="font-family: Roboto Mono, monospace"></pre>

    <!-- Scripts -->
    <!-- Keep jQuery if nashville.js uses it, otherwise optional -->
    <!-- <script type=" text/javascript" src="../../assets/jquery/jquery.min.js"></script> -->
    <!-- The NEW Nashville conversion script -->
    <script type="text/javascript" src="../js/nashville.js"></script> <!-- Adjust path -->


    <script>
        document.addEventListener('DOMContentLoaded', function ()
        {
            // Retrieve song data from sessionStorage
            const songDataString = sessionStorage.getItem('songData');

            if (!songDataString)
            {
                document.getElementById('song-content').textContent = "Error: No song data found.";
                return;
            }

            try
            {
                const songData = JSON.parse(songDataString);
                const songTitleElement = document.getElementById('song-title');
                const songContentElement = document.getElementById('song-content');
                const keysContainerId = 'transpose-keys'; // ID of the div for key buttons

                // Display Title (Clean up name)
                if (songTitleElement && songData.name)
                {
                    let title = songData.name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); // Simple title case
                    title = title.replace(/ Nns$/, ' (NNS)'); // Make NNS explicit if in filename
                    songTitleElement.textContent = title;
                }


                // Check if the content type is 'chords' (expecting NNS)
                if (songData.type === 'chords')
                {
                    // Initialize the Nashville Transposer
                    setupNashvilleTranspose(songData.content, songContentElement.id, keysContainerId);
                } else
                {
                    // If it's just lyrics, display them directly
                    songContentElement.textContent = songData.content;
                    // Optionally hide the transpose keys if only lyrics
                    document.getElementById(keysContainerId).style.display = 'none';
                }

                // Clear the item from storage once used (optional)
                // sessionStorage.removeItem('songData');

            } catch (error)
            {
                console.error("Error processing song data:", error);
                document.getElementById('song-content').textContent = "Error: Could not process song data.";
            }
        });
    </script>

</body>

</html>